#!/bin/bash

# install homebrew
if [ -z "$(which brew)" ]; then
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

# install basic programs
programs=(
  fish
  fzf
  git
  hub
  neovim
  the_silver_searcher
  tig
  tmux
  wget
)
for program in ${programs[@]}; do
  if [ -z "$(brew list | grep $program)" ]; then
    brew install $program
  fi
done
if [ -z "$(which mux)" ]; then
  gem install tmuxinator
fi

# change to fish shell
if [ "$SHELL" -ne "/usr/local/bin/fish" ]; then
  echo "/usr/local/bin/fish" | sudo tee -a /etc/shells
  chsh -s /usr/local/bin/fish
  fish_update_completions
fi

current_dir=`pwd`

# copy dot files to home dir
for file in \.*; do
  # skip .git, . and ..
  if [[ "${file}" != '.git' && "${file}" != '.gitignore' && "${file}" != '.' && "${file}" != '..' ]]; then
    ln -sf "$current_dir/$file" ~/$file
  fi
done

# copy fish config
mkdir -p ~/.config/fish/functions
for file in config/fish/functions/*; do
  file_name=$(echo -n $file | sed "s#config/fish/functions/##")
  ln -sf "$current_dir/$file" "~/.config/fish/functions/$file_name"
done

mkdir -p ~/.config
ln -sf ~/.vim ~/.config/nvim
ln -sf ~/.vimrc ~/.config/nvim/init.vim

mkdir -p ~/.vim/colors
ln -sf "$current_dir/zenburn.vim" ~/.vim/colors/zenburn.vim
ln -sfh "$current_dir/snippets" ~/.vim/snippets
mkdir -p ~/.vim/bundle
if [ ! -d ~/.vim/bundle/Vundle.vim ]; then
  git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
fi

mkdir -p ~/bin
ln -sf "$current_dir/bin/cb" ~/bin/cb
ln -sf "$current_dir/bin/tmux_battery_charge_indicator.sh" ~/bin/tmux_battery_charge_indicator.sh
ln -sf "$current_dir/bin/hcp" ~/bin/hcp
